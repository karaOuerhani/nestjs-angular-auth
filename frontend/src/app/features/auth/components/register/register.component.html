<div class="register-container">
	<div class="register-title">Créer un compte</div>
	<form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>
		<div class="form-group">
			<label for="name">Nom</label>
			<input
				pInputText
				id="name"
				type="text"
				formControlName="name"
				autocomplete="name"
				placeholder="Votre nom" />
			<div *ngIf="submitted && f['name'].errors" class="error-message">
				<span *ngIf="f['name'].errors['required']">Nom requis.</span>
				<span *ngIf="f['name'].errors['minlength']">Au moins 2 caractères.</span>
			</div>
		</div>
		<div class="form-group">
			<label for="email">Email</label>
			<input
				pInputText
				id="email"
				type="email"
				formControlName="email"
				autocomplete="email"
				placeholder="votre@email.com" />
			<div *ngIf="submitted && f['email'].errors" class="error-message">
				<span *ngIf="f['email'].errors['required']">Email requis.</span>
				<span *ngIf="f['email'].errors['email']">Format email invalide.</span>
			</div>
		</div>
		<div class="form-group">
			<label for="password">Mot de passe</label>
			<input
				pInputText
				id="password"
				type="password"
				formControlName="password"
				autocomplete="new-password"
				placeholder="Votre mot de passe" />
			<div *ngIf="submitted && f['password'].errors" class="error-message">
				<span *ngIf="f['password'].errors['required']">Mot de passe requis.</span>
				<span *ngIf="f['password'].errors['minlength']">Au moins 8 caractères.</span>
				<span *ngIf="f['password'].errors['strong']">
					Le mot de passe doit contenir au moins&nbsp;:
					<ul class="password-strong-list">
						<li>Une lettre majuscule</li>
						<li>Une lettre minuscule</li>
						<li>Un chiffre</li>
						<li>Un caractère spécial</li>
					</ul>
				</span>
			</div>
		</div>
		<div class="form-group">
			<label for="confirmPassword">Confirmer le mot de passe</label>
			<input
				pInputText
				id="confirmPassword"
				type="password"
				formControlName="confirmPassword"
				autocomplete="new-password"
				placeholder="Confirmez votre mot de passe" />
			<div *ngIf="submitted && (f['confirmPassword'].errors || registerForm.errors?.['mismatch'])" class="error-message">
				<span *ngIf="f['confirmPassword'].errors?.['required']">Confirmation requise.</span>
				<span *ngIf="registerForm.errors?.['mismatch']">Les mots de passe ne correspondent pas.</span>
			</div>
		</div>
		<div *ngIf="error" class="error-message">{{ error }}</div>
		<p-button
			type="submit"
			label="Créer le compte"
			[loading]="loading"
			[disabled]="registerForm.invalid"
			styleClass="w-full">
		</p-button>
	</form>
	<div class="login-link">
		<p>Déjà un compte ? <a routerLink="/auth/login">Se connecter</a></p>
	</div>
</div>

<!-- Verification Dialog -->
<p-dialog
	[(visible)]="verificationDialogVisible"
	[modal]="true"
	[closable]="true"
	[closeOnEscape]="false"
	header="Vérifiez votre email"
	[style]="{width: '500px'}">

	<div class="verification-content">
		<p>Un code de vérification a été envoyé à votre adresse email. Veuillez l'entrer ci-dessous :</p>

		<div class="form-group">
			<label for="verificationCode">Code de vérification (6 chiffres)</label>
			<input
				pInputText
				id="verificationCode"
				[(ngModel)]="verificationCode"
				placeholder="123456"
				maxlength="6"
				class="verification-input"
				(keyup.enter)="verifyCode()">
		</div>

		<div class="dialog-actions">
			<p-button
				label="Annuler"
				icon="pi pi-times"
				class="p-button-secondary"
				(onClick)="closeDialog()">
			</p-button>
			<p-button
				label="Vérifier"
				icon="pi pi-check"
				[loading]="verifying"
				[disabled]="!verificationCode || verificationCode.length !== 6"
				(onClick)="verifyCode()">
			</p-button>
		</div>

		<div class="login-link">
			<p>Déjà un compte ? <a href="#" (click)="goToLogin()">Se connecter</a></p>
		</div>
	</div>
</p-dialog>
<p-toast></p-toast>
